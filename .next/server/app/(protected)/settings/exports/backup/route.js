(()=>{var e={};e.id=161,e.ids=[161],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3568:()=>{},5486:e=>{"use strict";e.exports=require("bcrypt")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},43817:(e,r,t)=>{"use strict";t.d(r,{db:()=>a});var s=t(96330);global.__prisma||(global.__prisma=new s.PrismaClient),global.__prisma.$connect();let a=global.__prisma},44372:(e,r,t)=>{"use strict";t.d(r,{j2:()=>g,LX:()=>v,Y9:()=>x});var s=t(35039);s.z.enum(["USER","EDITOR","ADMIN"]).default("USER");let a=s.z.string().email().transform(e=>e.toLowerCase().trim()),o=s.z.string().min(8).max(100).transform(e=>e.trim());s.z.object({email:a,password:o});let n=s.z.object({username:s.z.string(),password:s.z.string()});s.z.object({email:a}),s.z.object({password:o,passwordConfirmation:o,token:s.z.string().optional()}).refine(e=>e.password===e.passwordConfirmation,{message:"Passwords don't match",path:["passwordConfirmation"]}),s.z.object({currentPassword:s.z.string(),newPassword:o});var i=t(43817),p=t(85638),u=t(6766),c=t(5486),d=t.n(c);let l=Number.parseInt(process.env.SALT_ROUNDS||"");if(!l||!Number.isInteger(l))throw Error("SALT_ROUNDS environment variable is not set");let m=async(e,r)=>await d().compare(e,r),{auth:g,handlers:x,signIn:w,signOut:b}=(0,p.Ay)({trustHost:"true"===process.env.TRUST_HOST,useSecureCookies:"false"!==process.env.SECURE_COOKIES,callbacks:{authorized:async({auth:e})=>!!e,jwt:({token:e,user:r})=>(r&&(e.user=r),e),session:({session:e,token:r})=>({...e,user:{...e.user,...r.user}})},cookies:{sessionToken:{options:{}}},providers:[(0,u.A)({name:"credentials",async authorize(e,r){try{let{username:r,password:t}=n.parse(e),s=await i.db.user.findFirst({where:{username:r}});if(s&&await m(t,s.passwordHash))return{id:s.id,name:s.username,role:s.role}}catch(e){return null}return console.log("failed to authorize..."),null}})],pages:{signIn:"/auth/login"}}),v=async e=>{let r=await g();return e.findIndex(e=>e===r?.user.role)>=0}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},89963:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>w,routeModule:()=>l,serverHooks:()=>x,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>g});var s={};t.r(s),t.d(s,{GET:()=>d});var a=t(99268),o=t(24825),n=t(55472),i=t(44372);let p=require("better-sqlite3");var u=t.n(p),c=t(72509);let d=(0,i.j2)(e=>{if(e.auth?.user.role!=="ADMIN")return c.NextResponse.json({error:"Unauthorized"},{status:403});try{let e=new(u())("db/db.sqlite").serialize(),r=Buffer.from(e),t=new Date,s=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0"),n=`db-${s}-${a}-${o}.sqlite`,i={"Content-Type":"application/octet-stream","Content-Disposition":`attachment; filename="${n}"`};return new c.NextResponse(r,{headers:i})}catch(e){return console.error("Error exporting database:",e),c.NextResponse.json({error:"Failed to export database"},{status:500})}}),l=new a.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/(protected)/settings/exports/backup/route",pathname:"/settings/exports/backup",filename:"route",bundlePath:"app/(protected)/settings/exports/backup/route"},resolvedPagePath:"/Users/jad/Desktop/dev/smart/new-arc/app/(protected)/settings/exports/backup/route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:m,workUnitAsyncStorage:g,serverHooks:x}=l;function w(){return(0,n.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:g})}},93840:()=>{},96330:e=>{"use strict";e.exports=require("@prisma/client")},99268:(e,r,t)=>{"use strict";e.exports=t(44870)}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[175,509,667],()=>t(89963));module.exports=s})();